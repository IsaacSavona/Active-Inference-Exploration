i think there still might be some mistakes in the mermaid diagram explaining how the algorithm works. there is still a box which says "GRAD" which i find strange. could you format the mermaid diagram to reflect the actual algorithm? feel free to take a moment correct any differences that exist now between the diagram and the real algorithm. feel free to use math snippets in the diagram to make the algorithm more explicit.